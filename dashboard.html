<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>لوحة تحكم بلوجر</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f4f4f4;
      color: #333;
    }

    header {
      background: #1e88e5;
      color: #fff;
      padding: 1rem;
      text-align: center;
    }

    .container {
      display: grid;
      grid-template-columns: 1fr 3fr;
      gap: 1rem;
      padding: 1rem;
    }

    aside {
      background: #fff;
      padding: 1rem;
      border-radius: 8px;
    }

    main {
      background: #fff;
      padding: 1rem;
      border-radius: 8px;
    }

    .post {
      border-bottom: 1px solid #ddd;
      padding: 0.5rem 0;
    }

    .post h3 {
      margin: 0;
      display: inline-block;
    }

    .actions {
      float: left;
    }

    .actions button {
      margin-left: 5px;
      background: none;
      border: none;
      cursor: pointer;
      color: #1e88e5;
    }

    .dark-mode {
      background-color: #121212;
      color: #eee;
    }

    .dark-mode header {
      background: #333;
    }

    .dark-mode .post {
      border-color: #555;
    }

    .toggle-mode {
      position: fixed;
      top: 10px;
      left: 10px;
      cursor: pointer;
      background: #fff;
      padding: 10px;
      border-radius: 50%;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
    }
  </style>
</head>

<body>
  <div class="toggle-mode" onclick="toggleDarkMode()">
    <i class="fas fa-adjust"></i>
  </div>
  <header>
    <h1>لوحة تحكم بلوجر</h1>
  </header>
  <div class="container">
    <aside>
      <h2>القائمة</h2>
      <ul>
        <li><a href="#" onclick="fetchPosts()">📄 عرض المقالات</a></li>
        <li><a href="#" onclick="fetchPages()">📄 عرض الصفحات</a></li>
        <li><a href="#" onclick="createNewPost()">✍️ مقال جديد</a></li>
      </ul>
    </aside>
    <main>
      <div id="content">
        <p>اختر من القائمة لبدء التحكم.</p>
      </div>
    </main>
  </div>

  <script>
    const blogId = "277624714973052630";
    const token = new URLSearchParams(window.location.hash.substring(1)).get("access_token");

    function toggleDarkMode() {
      document.body.classList.toggle("dark-mode");
    }

    async function fetchPosts() {
      const res = await fetch(`https://www.googleapis.com/blogger/v3/blogs/${blogId}/posts`, {
        headers: { Authorization: `Bearer ${token}` }
      });
      const data = await res.json();
      let html = '<h2>📄 المقالات</h2>';
      data.items.forEach(post => {
        html += `<div class="post">
          <h3>${post.title}</h3>
          <div class="actions">
            <button onclick="editPost('${post.id}')"><i class='fas fa-pen'></i></button>
            <button onclick="deletePost('${post.id}')"><i class='fas fa-trash'></i></button>
          </div>
        </div>`;
      });
      document.getElementById("content").innerHTML = html;
    }

    async function fetchPages() {
      const res = await fetch(`https://www.googleapis.com/blogger/v3/blogs/${blogId}/pages`, {
        headers: { Authorization: `Bearer ${token}` }
      });
      const data = await res.json();
      let html = '<h2>📄 الصفحات</h2>';
      data.items.forEach(page => {
        html += `<div class="post">
          <h3>${page.title}</h3>
          <div class="actions">
            <button onclick="editPage('${page.id}')"><i class='fas fa-pen'></i></button>
            <button onclick="deletePage('${page.id}')"><i class='fas fa-trash'></i></button>
          </div>
        </div>`;
      });
      document.getElementById("content").innerHTML = html;
    }

    function createNewPost() {
      document.getElementById("content").innerHTML = `
        <h2>✍️ مقال جديد</h2>
        <input id="title" placeholder="عنوان المقال" style="width: 100%; padding: 10px; margin-bottom: 10px;">
        <textarea id="contentArea" placeholder="محتوى المقال" style="width: 100%; height: 200px; padding: 10px;"></textarea>
        <button onclick="submitPost()">📝 نشر</button>
      `;
    }

    async function submitPost() {
      const title = document.getElementById("title").value;
      const content = document.getElementById("contentArea").value;
      await fetch(`https://www.googleapis.com/blogger/v3/blogs/${blogId}/posts/`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          Authorization: `Bearer ${token}`
        },
        body: JSON.stringify({ title, content })
      });
      alert("تم النشر بنجاح!");
      fetchPosts();
    }

    function editPost(id) {
      alert("تعديل المقال غير مفعل حاليًا.");
    }

    function deletePost(id) {
      if (confirm("هل تريد حذف هذا المقال؟")) {
        fetch(`https://www.googleapis.com/blogger/v3/blogs/${blogId}/posts/${id}`, {
          method: 'DELETE',
          headers: { Authorization: `Bearer ${token}` }
        }).then(() => fetchPosts());
      }
    }

    function editPage(id) {
      alert("تعديل الصفحات غير مفعل حاليًا.");
    }

    function deletePage(id) {
      if (confirm("هل تريد حذف هذه الصفحة؟")) {
        fetch(`https://www.googleapis.com/blogger/v3/blogs/${blogId}/pages/${id}`, {
          method: 'DELETE',
          headers: { Authorization: `Bearer ${token}` }
        }).then(() => fetchPages());
      }
    }
  </script>
</body>

</html>
