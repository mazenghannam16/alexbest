<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ù„ÙˆØ­Ø© Ù†Ø´Ø± Ø£ÙÙ„Ø§Ù… ÙˆÙ…Ø³Ù„Ø³Ù„Ø§Øª Ø¹Ù„Ù‰ Ø¨Ù„ÙˆØ¬Ø±</title>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@700&display=swap');
    body {
      font-family: 'Cairo', sans-serif;
      direction: rtl;
      background: #3f255f;
      color: #fff;
      padding: 20px;
    }
    h2 {
      color: #ffd700;
      font-size: 28px;
    }
    .movie-card {
      background: #1e1e1e;
      border-radius: 10px;
      margin: 10px 0;
      padding: 15px;
      overflow: hidden;
      box-shadow: 0 0 10px rgba(0,0,0,0.4);
    }
    .movie-card img {
      max-width: 120px;
      float: left;
      margin-left: 15px;
      border-radius: 5px;
    }
    .movie-info {
      overflow: hidden;
    }
    button, select, input, textarea {
      padding: 10px;
      margin: 5px;
      border-radius: 5px;
      border: none;
      font-family: 'Cairo', sans-serif;
      font-weight: bold;
    }
    button {
      background: #ffd700;
      color: #000;
      cursor: pointer;
    }
    .inline-message {
      display: inline-block;
      margin-right: 10px;
      font-size: 14px;
      background: #28a745;
      padding: 5px 10px;
      border-radius: 4px;
    }
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background-color: #28a745;
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 16px;
      z-index: 9999;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
      opacity: 0;
      transition: opacity 0.4s ease;
    }
    .toast.error {
      background-color: #dc3545;
    }
  </style>
</head>
<body>
  <h2><i class="fas fa-film"></i> Ù„ÙˆØ­Ø© Ù†Ø´Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…Ù† TMDB Ø¥Ù„Ù‰ Ø¨Ù„ÙˆØ¬Ø±</h2>
  <div id="googleButton"></div>
  <br>
  <input type="text" id="movieName" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„ÙÙŠÙ„Ù… Ø£Ùˆ Ø§Ù„Ù…Ø³Ù„Ø³Ù„">
  <select id="mediaType">
    <option value="movie">ğŸ¥ ÙÙŠÙ„Ù…</option>
    <option value="tv">ğŸ“º Ù…Ø³Ù„Ø³Ù„</option>
  </select>
  <button onclick="searchMovies()"><i class="fas fa-search"></i> Ø¨Ø­Ø«</button>

  <br><br>
  <textarea id="multiSearch" placeholder="Ø§ÙƒØªØ¨ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø£ÙÙ„Ø§Ù… Ø£Ùˆ Ø§Ù„Ù…Ø³Ù„Ø³Ù„Ø§Øª Ù…ÙØµÙˆÙ„Ø© Ø¨ÙØ§ØµÙ„Ø© Ù…Ø«Ù„Ø§Ù‹: ÙˆÙ„Ø§Ø¯ Ø±Ø²Ù‚, Ø§Ù„Ø¯Ø³Ø§Ø³, Interstellar" rows="3" style="width:100%; margin-top:10px;"></textarea>
  <button onclick="multiSearchHandler()"><i class="fas fa-clone"></i> Ø¨Ø­Ø« Ù…ØªØ¹Ø¯Ø¯</button>

  <div id="results"></div>

  <script>
    const apiKey = '4b1125dc507cd0f303b025b30d6311dd';
    const blogId = '277624714973052630';
    const clientId = '6996456913-t6ceju8vos0icbev531e7iqdrtm7g7u4.apps.googleusercontent.com';
    const scope = 'https://www.googleapis.com/auth/blogger';

    let tokenClient;
    let accessToken = null;

    window.onload = () => {
      tokenClient = google.accounts.oauth2.initTokenClient({
        client_id: clientId,
        scope: scope,
        callback: (tokenResponse) => {
          accessToken = tokenResponse.access_token;
          document.getElementById('googleButton').innerHTML = '<span class="inline-message">âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</span>';
        }
      });
    };

    function ensureAuth(callback) {
      if (!accessToken) {
        tokenClient.requestAccessToken();
      } else {
        callback();
      }
    }

    function showToast(message, isError = false) {
      const toast = document.createElement('div');
      toast.className = 'toast' + (isError ? ' error' : '');
      toast.innerText = message;
      document.body.appendChild(toast);
      setTimeout(() => { toast.style.opacity = 1; }, 100);
      setTimeout(() => {
        toast.style.opacity = 0;
        setTimeout(() => toast.remove(), 500);
      }, 3000);
    }

    function multiSearchHandler() {
      const names = document.getElementById('multiSearch').value.split(',').map(name => name.trim()).filter(Boolean);
      const type = document.getElementById('mediaType').value;

      if (!names.length) {
        showToast('âŒ Ø£Ø¯Ø®Ù„ Ø£Ø³Ù…Ø§Ø¡ ØµØ­ÙŠØ­Ø© Ù…ÙØµÙˆÙ„Ø© Ø¨ÙØ§ØµÙ„Ø©.', true);
        return;
      }

      document.getElementById('results').innerHTML = '';

      names.forEach(name => {
        document.getElementById('movieName').value = name;
        searchMovies(1, true); // Ù†Ù…Ø±Ø± true Ù„Ù†Ø¹Ø±Ù Ø£Ù†Ù‡ Ø¬Ø§ÙŠ Ù…Ù† Ø¨Ø­Ø« Ù…ØªØ¹Ø¯Ø¯
      });
    }

    async function searchMovies(page = 1, isMulti = false) {
      const query = document.getElementById('movieName').value.trim();
      const type = document.getElementById('mediaType').value;
      const resDiv = document.getElementById('results');

      if (page === 1 && !isMulti) resDiv.innerHTML = '';

      const url = `https://api.themoviedb.org/3/search/${type}?api_key=${apiKey}&query=${encodeURIComponent(query)}&language=ar&page=${page}`;

      const res = await fetch(url);
      const data = await res.json();

      if (!data.results || data.results.length === 0) {
        resDiv.innerHTML += '<p>âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬.</p>';
        return;
      }

      data.results.forEach(item => {
        const title = type === 'movie' ? item.title : item.name;
        const year = (item.release_date || item.first_air_date || '').split('-')[0];
        const overview = item.overview || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ';
        const poster = item.poster_path ? `https://image.tmdb.org/t/p/w500${item.poster_path}` : '';

        const card = document.createElement('div');
        card.className = 'movie-card';
        card.innerHTML = `
          <div class="movie-info">
            <img src="${poster}" alt="">
            <h3>${title} (${year})</h3>
            <p>${overview.slice(0, 150)}...</p>
            <button onclick='ensureAuth(() => publishToBlogger(${JSON.stringify({ title, overview, poster, year, type })}))'>
              <i class="fas fa-upload"></i> Ù†Ø´Ø± Ø¥Ù„Ù‰ Ø¨Ù„ÙˆØ¬Ø±
            </button>
          </div>
        `;
        resDiv.appendChild(card);
      });

      // ğŸ‘‡ Ø´Ø±Ø· ÙŠÙ…Ù†Ø¹ Ø¸Ù‡ÙˆØ± Ø²Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø²ÙŠØ¯ ÙÙŠ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ØªØ¹Ø¯Ø¯
      if (!isMulti && !document.getElementById('multiSearch').value.trim()) {
        const loadMoreBtn = document.createElement('button');
        loadMoreBtn.innerHTML = '<i class="fas fa-plus"></i> ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø²ÙŠØ¯';
        loadMoreBtn.onclick = () => {
          loadMoreBtn.remove();
          searchMovies(page + 1);
        };
        resDiv.appendChild(loadMoreBtn);
      }
    }

    async function publishToBlogger(data) {
      const postHtml = `
<yourdesigns>
  <mohamedsafyan>
    <div class="post-single">
      <div class="container">
        <div class="single-poster">
          <div class="separator" style="clear: both;">
            <a href="${data.poster}" style="display: block; padding: 1em 0; text-align: center;">
              <img alt="${data.title}" src="${data.poster}" />
            </a>
          </div>
        </div>
        <div class="post-single-content">
          <h1>${data.title}</h1>
          <div class="post-single-watching">
            <div class="story">
              <h2>Ø§Ù„Ù‚ØµØ©</h2>
              <p>${data.overview}</p>
            </div>
          </div>
          <ul class="post-information-list">
            <li><span>Ø§Ù„Ø¬ÙˆØ¯Ø©:</span> 1080p</li>
            <li><span>Ø§Ù„Ù‚Ø³Ù…:</span> ${data.type === 'movie' ? 'Ø£ÙÙ„Ø§Ù…' : 'Ù…Ø³Ù„Ø³Ù„Ø§Øª'}</li>
            <li><span>Ø§Ù„Ø³Ù†Ø©:</span> ${data.year}</li>
            <li><span>ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨ÙˆØ§Ø³Ø·Ø©:</span> Mazen Mohamed</li>
          </ul>
          <div class="post-single-buttons">
            <a href="http://alexbesteg.blogspot.com/p/cleaner-2025.html" class="WatchingArea Hoverable">
              <span class="WatchNow">
                <em class="WatchIcon"></em>
                Ù…Ø´Ø§Ù‡Ø¯Ø© ${data.type === 'movie' ? 'ÙÙŠÙ„Ù…' : 'Ù…Ø³Ù„Ø³Ù„'} ${data.title} ${data.year}
                <i class="fa fa-angle-left"></i>
              </span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </mohamedsafyan>
</yourdesigns>`;

      const res = await fetch(`https://www.googleapis.com/blogger/v3/blogs/${blogId}/posts/`, {
        method: 'POST',
        headers: {
          Authorization: `Bearer ${accessToken}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          kind: 'blogger#post',
          title: `Ù…Ø´Ø§Ù‡Ø¯Ø© ${data.type === 'movie' ? 'ÙÙŠÙ„Ù…' : 'Ù…Ø³Ù„Ø³Ù„'} ${data.title} ${data.year}`,
          content: postHtml
        })
      });

      const result = await res.json();

      if (result && result.url) {
        showToast(`âœ… ØªÙ… Ù†Ø´Ø± ${data.type === 'movie' ? 'Ø§Ù„ÙÙŠÙ„Ù…' : 'Ø§Ù„Ù…Ø³Ù„Ø³Ù„'}: ${data.title}`);
      } else {
        showToast('âŒ ÙØ´Ù„ Ø§Ù„Ù†Ø´Ø±ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.', true);
      }
    }
  </script>
</body>
</html>
